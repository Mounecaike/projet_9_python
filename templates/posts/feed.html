{% extends "base.html" %}
{% block content %}
  <h2>ğŸ“° Votre flux</h2>

  {% for post in posts %}
    {% if post.title %}
      <!-- ğŸŸï¸ Ticket seul -->
      <div style="border:1px solid #ccc; padding:10px; margin-bottom:10px;">
        <h3>ğŸŸï¸ {{ post.title }}</h3>
        <p>{{ post.description }}</p>
        <small>par {{ post.user.username }} â€” {{ post.time_created }}</small>
        <a href="{% url 'posts:create_review_from_ticket' post.id %}">âœï¸ Ã‰crire une critique</a>


        <!-- VÃ©rifie si le ticket a une review -->
        {% for review in post.review_set.all %}
          <div style="border:1px dashed #aaa; margin-top:10px; padding:8px; background:#f9f9f9;">
            <h4>ğŸ“ Critique associÃ©e : {{ review.headline }}</h4>
            <p>{{ review.body }}</p>
            <small>par {{ review.user.username }}</small>
          </div>
        {% empty %}
          <p><em>Aucune critique pour ce ticket.</em></p>
        {% endfor %}
      </div>

    {% elif post.headline %}
      <!-- ğŸ“ Review seule (au cas oÃ¹ son ticket nâ€™est pas dans le feed) -->
      <div style="border:1px solid #aaa; background:#f8f8f8; padding:10px; margin-bottom:10px;">
        <h3>ğŸ“ {{ post.headline }}</h3>
        <p>{{ post.body }}</p>
        <small>par {{ post.user.username }} â€” {{ post.time_created }}</small>

        {% if post.ticket %}
          <div style="border:1px dashed #ccc; margin-top:10px; padding:8px;">
            <strong>RÃ©pond Ã  :</strong> {{ post.ticket.title }}
          </div>
        {% endif %}
      </div>
    {% endif %}
  {% empty %}
    <p>Aucun contenu Ã  afficher.</p>
  {% endfor %}
{% endblock %}
