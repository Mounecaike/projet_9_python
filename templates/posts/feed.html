{% extends "base.html" %}
{% block content %}
  <!-- === HEADER DU FLUX === -->
    <h2>📰 Votre flux</h2>

  <!-- === BOUTONS D’ACTION === -->
  <div style="display:flex; gap:15px; justify-content:center; margin-bottom:30px;">
    <a href="{% url 'posts:create_ticket' %}" class="btn">🎟️ Demander une critique</a>
    <a href="{% url 'posts:create_review' ticket_id=0 %}" class="btn">📝 Créer une critique</a>
  </div>

  <!-- === FLUX DES POSTS === -->
  {% for post in posts %}
    {% if post.title %}
      <!-- 🎟️ Ticket -->
      <div class="ticket">
        <h3>🎟️ {{ post.title }}</h3>
        <p>{{ post.description }}</p>
        {% if post.image %}
          <img src="{{ post.image.url }}" alt="{{ post.title }}" class="img-ticket">
        {% endif %}<br>
        <small>par {{ post.user.username }} — {{ post.time_created }}</small><br>
        <a href="{% url 'posts:create_review_from_ticket' post.id %}" class="btn">✍️ Écrire une critique</a>

        {% for review in post.review_set.all %}
          <div class="review">
            <h4>📝 Critique : {{ review.headline }}</h4>
            <p>{{ review.body }}</p>
            <small>par {{ review.user.username }}</small>
          </div>
        {% empty %}
          <p><em>Aucune critique pour ce ticket.</em></p>
        {% endfor %}
      </div>

    {% elif post.headline %}
      <!-- 📝 Review -->
      <div class="review">
        <h3>📝 {{ post.headline }}</h3>
        <p>{{ post.body }}</p>
        <small>par {{ post.user.username }} — {{ post.time_created }}</small>

        {% if post.ticket %}
          <div class="ticket" style="margin-top:10px;">
            <strong>Répond à :</strong> {{ post.ticket.title }}
          </div>
        {% endif %}
      </div>
    {% endif %}
  {% empty %}
    <p>Aucun contenu à afficher.</p>
  {% endfor %}


{% endblock %}
