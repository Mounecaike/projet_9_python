{% extends "base.html" %}
{% block content %}
  <h2>📰 Votre flux</h2>

  {% for post in posts %}
    {% if post.title %}
      <!-- 🎟️ Ticket seul -->
      <div style="border:1px solid #ccc; padding:10px; margin-bottom:10px;">
        <h3>🎟️ {{ post.title }}</h3>
        <p>{{ post.description }}</p>
        <small>par {{ post.user.username }} — {{ post.time_created }}</small>
        <a href="{% url 'posts:create_review_from_ticket' post.id %}">✍️ Écrire une critique</a>


        <!-- Vérifie si le ticket a une review -->
        {% for review in post.review_set.all %}
          <div style="border:1px dashed #aaa; margin-top:10px; padding:8px; background:#f9f9f9;">
            <h4>📝 Critique associée : {{ review.headline }}</h4>
            <p>{{ review.body }}</p>
            <small>par {{ review.user.username }}</small>
          </div>
        {% empty %}
          <p><em>Aucune critique pour ce ticket.</em></p>
        {% endfor %}
      </div>

    {% elif post.headline %}
      <!-- 📝 Review seule (au cas où son ticket n’est pas dans le feed) -->
      <div style="border:1px solid #aaa; background:#f8f8f8; padding:10px; margin-bottom:10px;">
        <h3>📝 {{ post.headline }}</h3>
        <p>{{ post.body }}</p>
        <small>par {{ post.user.username }} — {{ post.time_created }}</small>

        {% if post.ticket %}
          <div style="border:1px dashed #ccc; margin-top:10px; padding:8px;">
            <strong>Répond à :</strong> {{ post.ticket.title }}
          </div>
        {% endif %}
      </div>
    {% endif %}
  {% empty %}
    <p>Aucun contenu à afficher.</p>
  {% endfor %}
{% endblock %}
