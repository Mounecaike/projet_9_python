{% extends "base.html" %}
{% block content %}
  <!-- === HEADER DU FLUX === -->
    <h2>ğŸ“° Votre flux</h2>

  <!-- === BOUTONS Dâ€™ACTION === -->
  <div style="display:flex; gap:15px; justify-content:center; margin-bottom:30px;">
    <a href="{% url 'posts:create_ticket' %}" class="btn">ğŸŸï¸ Demander une critique</a>
    <a href="{% url 'posts:create_review' ticket_id=0 %}" class="btn">ğŸ“ CrÃ©er une critique</a>
  </div>

  <!-- === FLUX DES POSTS === -->
  {% for post in posts %}
    {% if post.title %}
      <!-- ğŸŸï¸ Ticket -->
      <div class="ticket">
        <h3>ğŸŸï¸ {{ post.title }}</h3>
        <p>{{ post.description }}</p>
        {% if post.image %}
          <img src="{{ post.image.url }}" alt="{{ post.title }}" class="img-ticket">
        {% endif %}<br>
        <small>par {{ post.user.username }} â€” {{ post.time_created }}</small><br>
        <a href="{% url 'posts:create_review_from_ticket' post.id %}" class="btn">âœï¸ Ã‰crire une critique</a>

        {% for review in post.review_set.all %}
          <div class="review">
            <h4>ğŸ“ Critique : {{ review.headline }}</h4>
            <p>{{ review.body }}</p>
            <small>par {{ review.user.username }}</small>
          </div>
        {% empty %}
          <p><em>Aucune critique pour ce ticket.</em></p>
        {% endfor %}
      </div>

    {% elif post.headline %}
      <!-- ğŸ“ Review -->
      <div class="review">
        <h3>ğŸ“ {{ post.headline }}</h3>
        <p>{{ post.body }}</p>
        <small>par {{ post.user.username }} â€” {{ post.time_created }}</small>

        {% if post.ticket %}
          <div class="ticket" style="margin-top:10px;">
            <strong>RÃ©pond Ã  :</strong> {{ post.ticket.title }}
          </div>
        {% endif %}
      </div>
    {% endif %}
  {% empty %}
    <p>Aucun contenu Ã  afficher.</p>
  {% endfor %}


{% endblock %}
